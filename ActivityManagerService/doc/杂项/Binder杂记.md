# Binder杂记 #

linux文件系统中“一切皆文件”。而重点要说的是内存与硬盘文件的一些点。

一般程序如java中的函数以及变量等，都会在内存中申请空间。但linux中有些更多的东西：

1. linux文件系统会将内存映射成文件结点，比如/dev/tty1 之类的驱动结点。驱动处于内核空间，用户空间可以通过系统调用访问内核空间。
2. 内存分作**内核空间**和**用户空间**，两者的 **虚拟地址（即取址操作能取到的地址）**是独立分配的，会通过映射表映射到物理地址上。

## binder驱动 ##

1. binder驱动会调用mmap修改内存映射，通过修改映射表，让**用户空间和内核空间**的虚拟地址访问的同一个处于**内核空间**的物理地址。实际的内容是在内核空间由Binder驱动申请的。  

2. 两个应用需要通过binder进行跨进程通信，那么就需要访问Binder驱动所申请的内核空间地址。一个应用接收调用或接受数据，就是BnInterface，会从内核空间的物理地址取数据，从而达到调用的效果；一个应用发出数据或请求，就是BpInterface，会将内容写到内核空间的物理地址，从而达到发送的效果。

3. 通过上述方式，分配内存的时候就在内核空间，不管多少个Bp端发送请求到Bn端，其实只会有一次拷贝，那就是将内容拷贝到内核空间的物理地址这一次，访问内容的时候直接按照映射表取值即可，达到了一次访问的效果。